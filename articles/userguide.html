<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Saving objects to artifacts and back again • alabaster.base</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Saving objects to artifacts and back again">
<meta property="og:description" content="alabaster.base">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">alabaster.base</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/userguide.html">Saving objects to artifacts and back again</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Saving objects to artifacts and back again</h1>
                        <h4 data-toc-skip class="author">Aaron Lun</h4>
                  <a class="author_email" href="mailto:#"></a><a href="mailto:infinite.monkeys.with.keyboards@gmail.com" class="email">infinite.monkeys.with.keyboards@gmail.com</a>
      
                  
            <h4 data-toc-skip class="date">Revised: February 1,
2024</h4>
      
      
      <div class="hidden name"><code>userguide.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <em><a href="https://bioconductor.org/packages/3.19/alabaster.base" class="external-link">alabaster.base</a></em>
package (and its family) implements methods to save common Bioconductor
objects to file artifacts and load them back into R. This aims to
provide a functional equivalent to RDS-based serialization that is:</p>
<ul>
<li>More stable to changes in the class definition. Such changes would
typically require costly <code><a href="https://rdrr.io/pkg/BiocGenerics/man/updateObject.html" class="external-link">updateObject()</a></code> operations at best,
or invalidate RDS files at worst.</li>
<li>More interoperable with other analysis frameworks. All artifacts are
saved in standard formats (e.g., JSON, HDF5) and can be easily parsed by
applications in other languages by following the <a href="https://github.com/ArtifactDB/takane" class="external-link">relevant
specifications</a>.</li>
<li>More modular, with each object split into multiple artifacts. This
enables parts of the object to be loaded into memory according to each
application’s needs. Parts can also be updated cheaply on disk without
rewriting all files.</li>
</ul>
</div>
<div class="section level2">
<h2 id="quick-start">Quick start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<p>To demonstrate, let’s mock up a <code>DataFrame</code> object from
the <em><a href="https://bioconductor.org/packages/3.19/S4Vectors" class="external-link">S4Vectors</a></em>
package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/S4Vectors" class="external-link">S4Vectors</a></span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html" class="external-link">DataFrame</a></span><span class="op">(</span>X<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, Y<span class="op">=</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">df</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 10 rows and 2 columns</span></span>
<span><span class="co">##            X           Y</span></span>
<span><span class="co">##    &lt;integer&gt; &lt;character&gt;</span></span>
<span><span class="co">## 1          1           a</span></span>
<span><span class="co">## 2          2           b</span></span>
<span><span class="co">## 3          3           c</span></span>
<span><span class="co">## 4          4           d</span></span>
<span><span class="co">## 5          5           e</span></span>
<span><span class="co">## 6          6           f</span></span>
<span><span class="co">## 7          7           g</span></span>
<span><span class="co">## 8          8           h</span></span>
<span><span class="co">## 9          9           i</span></span>
<span><span class="co">## 10        10           j</span></span></code></pre>
<p>We’ll save this <code>DataFrame</code> to a directory:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">alabaster.base</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/saveObject.html">saveObject</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">tmp</span><span class="op">)</span></span></code></pre></div>
<p>And read it back in:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/readObject.html">readObject</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 10 rows and 2 columns</span></span>
<span><span class="co">##            X           Y</span></span>
<span><span class="co">##    &lt;integer&gt; &lt;character&gt;</span></span>
<span><span class="co">## 1          1           a</span></span>
<span><span class="co">## 2          2           b</span></span>
<span><span class="co">## 3          3           c</span></span>
<span><span class="co">## 4          4           d</span></span>
<span><span class="co">## 5          5           e</span></span>
<span><span class="co">## 6          6           f</span></span>
<span><span class="co">## 7          7           g</span></span>
<span><span class="co">## 8          8           h</span></span>
<span><span class="co">## 9          9           i</span></span>
<span><span class="co">## 10        10           j</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="class-specific-methods">Class-specific methods<a class="anchor" aria-label="anchor" href="#class-specific-methods"></a>
</h2>
<p>Each class implements a saving and reading method for use by the
<em>alabaster</em> framework. The saving method (for the
<code><a href="../reference/saveObject.html">saveObject()</a></code> generic) will save the object to one or more
files inside a user-specified directory:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/saveObject.html">saveObject</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">tmp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">tmp</span>, recursive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "basic_columns.h5" "OBJECT"</span></span></code></pre>
<p>Conversely, the reading function will - as the name suggests - load
the object back into memory, given the path to its directory. The
correct loading function for each class is automatically called by the
<code><a href="../reference/readObject.html">readObject()</a></code> function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/readObject.html">readObject</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 10 rows and 2 columns</span></span>
<span><span class="co">##            X           Y</span></span>
<span><span class="co">##    &lt;integer&gt; &lt;character&gt;</span></span>
<span><span class="co">## 1          1           a</span></span>
<span><span class="co">## 2          2           b</span></span>
<span><span class="co">## 3          3           c</span></span>
<span><span class="co">## 4          4           d</span></span>
<span><span class="co">## 5          5           e</span></span>
<span><span class="co">## 6          6           f</span></span>
<span><span class="co">## 7          7           g</span></span>
<span><span class="co">## 8          8           h</span></span>
<span><span class="co">## 9          9           i</span></span>
<span><span class="co">## 10        10           j</span></span></code></pre>
<p><em><a href="https://bioconductor.org/packages/3.19/alabaster.base" class="external-link">alabaster.base</a></em>
also provides a <code><a href="../reference/validateObject.html">validateObject()</a></code> function, which checks
that each object’s on-disk representation follows its associated
specification. For all <strong>alabaster</strong>-supported objects,
this validates the file contents against the <a href="https://github.com/ArtifactDB/takane" class="external-link"><strong>takane</strong>
specifications</a> - successful validation provides guarantees for
readers like <code><a href="../reference/readObject.html">readObject()</a></code> and <a href="https://github.com/ArtifactDB/dolomite-base" class="external-link"><strong>dolomite-base</strong></a>
(for Python). In fact, <code><a href="../reference/saveObject.html">saveObject()</a></code> will automatically run
<code><a href="../reference/validateObject.html">validateObject()</a></code> on the directory to ensure compliance.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/validateObject.html">validateObject</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span></code></pre></div>
<p><em><a href="https://bioconductor.org/packages/3.19/alabaster.base" class="external-link">alabaster.base</a></em>
itself supports a small set of classes from the <em><a href="https://bioconductor.org/packages/3.19/S4Vectors" class="external-link">S4Vectors</a></em>
packages; support for additional classes can be found in other packages
like <em><a href="https://bioconductor.org/packages/3.19/alabaster.ranges" class="external-link">alabaster.ranges</a></em>
and <em><a href="https://bioconductor.org/packages/3.19/alabaster.se" class="external-link">alabaster.se</a></em>.
Third-party developers can also add support for their own classes by
defining new methods, see the <a href="extensions.html"><em>Extensions</em></a> vignette for details.</p>
</div>
<div class="section level2">
<h2 id="operating-on-directories">Operating on directories<a class="anchor" aria-label="anchor" href="#operating-on-directories"></a>
</h2>
<p>Users can move freely rename or relocate directories and
<code><a href="../reference/readObject.html">readObject()</a></code> function will still work. For example, we can
easily copy the entire directory to a new file system and everything
will still be correctly referenced within the directory. The simplest
way to share objects is to just <code>zip</code> or <code>tar</code> the
staging directory for <em>ad hoc</em> distribution. For more serious
applications, <em><a href="https://bioconductor.org/packages/3.19/alabaster.base" class="external-link">alabaster.base</a></em>
can be used in conjunction with storage systems like AWS S3 for
large-scale distribution.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/saveObject.html">saveObject</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">tmp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.rename</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="va">tmp2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/readObject.html">readObject</a></span><span class="op">(</span><span class="va">tmp2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 10 rows and 2 columns</span></span>
<span><span class="co">##            X           Y</span></span>
<span><span class="co">##    &lt;integer&gt; &lt;character&gt;</span></span>
<span><span class="co">## 1          1           a</span></span>
<span><span class="co">## 2          2           b</span></span>
<span><span class="co">## 3          3           c</span></span>
<span><span class="co">## 4          4           d</span></span>
<span><span class="co">## 5          5           e</span></span>
<span><span class="co">## 6          6           f</span></span>
<span><span class="co">## 7          7           g</span></span>
<span><span class="co">## 8          8           h</span></span>
<span><span class="co">## 9          9           i</span></span>
<span><span class="co">## 10        10           j</span></span></code></pre>
<p>That said, it is unwise to manipulate the files inside the directory
created by <code><a href="../reference/saveObject.html">saveObject()</a></code>. Reading functions will usually
depend on specific file names or subdirectory structures within the
directory, and fiddling with them may cause unexpected results. Advanced
users can exploit this by loading components from subdirectories if only
the full object is not required:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating a nested DF to be a little spicy:</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html" class="external-link">DataFrame</a></span><span class="op">(</span>Z<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, AA<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html" class="external-link">DataFrame</a></span><span class="op">(</span>B<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, C<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">meta2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/saveObject.html">saveObject</a></span><span class="op">(</span><span class="va">df2</span>, <span class="va">tmp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now reading in the nested DF:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">tmp</span>, recursive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "basic_columns.h5"                 "OBJECT"                          </span></span>
<span><span class="co">## [3] "other_columns/1/basic_columns.h5" "other_columns/1/OBJECT"</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/readObject.html">readObject</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="st">"other_columns/1"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 5 rows and 2 columns</span></span>
<span><span class="co">##            B          C</span></span>
<span><span class="co">##    &lt;numeric&gt;  &lt;numeric&gt;</span></span>
<span><span class="co">## 1 0.08075014 -0.0843389</span></span>
<span><span class="co">## 2 0.83433304 -0.5540648</span></span>
<span><span class="co">## 3 0.60076089  0.7471766</span></span>
<span><span class="co">## 4 0.15720844 -0.9348197</span></span>
<span><span class="co">## 5 0.00739944 -0.4666204</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="extending-to-new-classes">Extending to new classes<a class="anchor" aria-label="anchor" href="#extending-to-new-classes"></a>
</h2>
<p>The <em>alabaster</em> framework is easily extended to new classes
by:</p>
<ol style="list-style-type: decimal">
<li>Writing a method for <code><a href="../reference/saveObject.html">saveObject()</a></code>. This should accept
an instance of the object and a path to a directory, and save the
contents of the object inside the directory. It should also produce an
<code>OBJECT</code> file that specifies the type of the object, e.g.,
<code>data_frame</code>, <code>hdf5_sparse_matrix</code>.</li>
<li>Writing a function for <code><a href="../reference/readObject.html">readObject()</a></code> and registering it
with <code><a href="../reference/readObject.html">registerReadObjectFunction()</a></code> (or, for core
Bioconductor classes, by requesting a change to the default registry in
<em><a href="https://bioconductor.org/packages/3.19/alabaster.base" class="external-link">alabaster.base</a></em>).
This should accept a path to a directory and read its contents to
reconstruct the object. The registered type should be the same as that
used in the <code>OBJECT</code> file.</li>
<li>Writing a function for <code><a href="../reference/validateObject.html">validateObject()</a></code> and registering
it with <code><a href="../reference/validateObject.html">registerValidateObjectFunction()</a></code>. This should
accept a path to a directory and read its contents to determine if it is
a valid on-disk representation. The registered type should be the same
as that used in the <code>OBJECT</code> file.
<ul>
<li>(optional) Devleopers can alternatively formalize the on-disk
representation by adding a specification to the <a href="https://github.com/ArtifactDB/takane" class="external-link"><strong>takane</strong></a>
repository. This aims to provide C++-based validators for each
representation, allowing us to enforce consistency across multiple
languages (e.g., Python). Any <strong>takane</strong> validator is
automatically used by <code><a href="../reference/validateObject.html">validateObject()</a></code> so no registration
is required.</li>
</ul>
</li>
</ol>
<p>To illustrate, let’s extend <em>alabaster</em> to the
<code>dgTMatrix</code> from the <em><a href="https://CRAN.R-project.org/package=Matrix" class="external-link">Matrix</a></em>
package. First, the saving method:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org" class="external-link">Matrix</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"saveObject"</span>, <span class="st">"dgTMatrix"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">path</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Create a directory to stash our contents.</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Saving a DataFrame with the triplet data.</span></span>
<span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html" class="external-link">DataFrame</a></span><span class="op">(</span>i <span class="op">=</span> <span class="va">x</span><span class="op">@</span><span class="va">i</span>, j <span class="op">=</span> <span class="va">x</span><span class="op">@</span><span class="va">j</span>, x <span class="op">=</span> <span class="va">x</span><span class="op">@</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"matrix.csv"</span><span class="op">)</span>, row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Adding some more information.</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"dimensions.txt"</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Creating an object file.</span></span>
<span>    <span class="fu"><a href="../reference/readObjectFile.html">saveObjectFile</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"triplet_sparse_matrix"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>And now the reading and validation methods. The registration is
usually done in the extension package’s <code>onLoad()</code>
function.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">readSparseTripletMatrix</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span>, <span class="va">metadata</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"matrix.csv"</span><span class="op">)</span>, header<span class="op">=</span><span class="cn">TRUE</span>, sep<span class="op">=</span><span class="st">","</span><span class="op">)</span></span>
<span>    <span class="va">dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"dimensions.txt"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/sparseMatrix.html" class="external-link">sparseMatrix</a></span><span class="op">(</span></span>
<span>         i<span class="op">=</span><span class="va">df</span><span class="op">$</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1L</span>, </span>
<span>         j<span class="op">=</span><span class="va">df</span><span class="op">$</span><span class="va">j</span> <span class="op">+</span> <span class="fl">1L</span>, </span>
<span>         x<span class="op">=</span><span class="va">df</span><span class="op">$</span><span class="va">x</span>, </span>
<span>         dims<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">dims</span><span class="op">)</span>,</span>
<span>         repr<span class="op">=</span><span class="st">"T"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="../reference/readObject.html">registerReadObjectFunction</a></span><span class="op">(</span><span class="st">"triplet_sparse_matrix"</span>, <span class="va">readSparseTripletMatrix</span><span class="op">)</span></span>
<span></span>
<span><span class="va">validateSparseTripletMatrix</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span>, <span class="va">metadata</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"matrix.csv"</span><span class="op">)</span>, header<span class="op">=</span><span class="cn">TRUE</span>, sep<span class="op">=</span><span class="st">","</span><span class="op">)</span></span>
<span>    <span class="va">dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"dimensions.txt"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">is.integer</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">i</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">i</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">df</span><span class="op">$</span><span class="va">i</span> <span class="op">&lt;</span> <span class="va">dims</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">is.integer</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">j</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">j</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">df</span><span class="op">$</span><span class="va">j</span> <span class="op">&lt;</span> <span class="va">dims</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="../reference/validateObject.html">registerValidateObjectFunction</a></span><span class="op">(</span><span class="st">"triplet_sparse_matrix"</span>, <span class="va">validateSparseTripletMatrix</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<p>Let’s run them and see how it works:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/sparseMatrix.html" class="external-link">sparseMatrix</a></span><span class="op">(</span></span>
<span>    i<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span>, </span>
<span>    j<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">6</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">8</span><span class="op">)</span>, </span>
<span>    x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, </span>
<span>    dims<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>    repr<span class="op">=</span><span class="st">"T"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">x</span></span></code></pre></div>
<pre><code><span><span class="co">## 10 x 10 sparse Matrix of class "dgTMatrix"</span></span>
<span><span class="co">##                                                           </span></span>
<span><span class="co">##  [1,] .          . 0.1956698 . . .         . .         . .</span></span>
<span><span class="co">##  [2,] .          . .         . . 0.4035381 . .         . .</span></span>
<span><span class="co">##  [3,] 0.06366146 . .         . . .         . .         . .</span></span>
<span><span class="co">##  [4,] .          . .         . . .         . .         . .</span></span>
<span><span class="co">##  [5,] .          . 0.3887013 . . .         . .         . .</span></span>
<span><span class="co">##  [6,] .          . .         . . .         . 0.9755478 . .</span></span>
<span><span class="co">##  [7,] .          . .         . . .         . .         . .</span></span>
<span><span class="co">##  [8,] .          . .         . . .         . .         . .</span></span>
<span><span class="co">##  [9,] .          . .         . . .         . .         . .</span></span>
<span><span class="co">## [10,] .          . .         . . .         . .         . .</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/saveObject.html">saveObject</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">tmp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">tmp</span>, recursive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "dimensions.txt" "matrix.csv"     "OBJECT"</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/readObject.html">readObject</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 10 x 10 sparse Matrix of class "dgTMatrix"</span></span>
<span><span class="co">##                                                           </span></span>
<span><span class="co">##  [1,] .          . 0.1956698 . . .         . .         . .</span></span>
<span><span class="co">##  [2,] .          . .         . . 0.4035381 . .         . .</span></span>
<span><span class="co">##  [3,] 0.06366146 . .         . . .         . .         . .</span></span>
<span><span class="co">##  [4,] .          . .         . . .         . .         . .</span></span>
<span><span class="co">##  [5,] .          . 0.3887013 . . .         . .         . .</span></span>
<span><span class="co">##  [6,] .          . .         . . .         . 0.9755478 . .</span></span>
<span><span class="co">##  [7,] .          . .         . . .         . .         . .</span></span>
<span><span class="co">##  [8,] .          . .         . . .         . .         . .</span></span>
<span><span class="co">##  [9,] .          . .         . . .         . .         . .</span></span>
<span><span class="co">## [10,] .          . .         . . .         . .         . .</span></span></code></pre>
<p>For more complex objects that are composed of multiple smaller
“child” objects, developers should consider saving each of their
children in subdirectories of <code>path</code>. This can be achieved by
calling <code><a href="../reference/altSaveObject.html">altSaveObject()</a></code> and <code><a href="../reference/altReadObject.html">altReadObject()</a></code> in
the saving and reading functions, respectively. (We use the
<code>alt*</code> versions of these functions to respect application
overrides, see below.)</p>
</div>
<div class="section level2">
<h2 id="creating-applications">Creating applications<a class="anchor" aria-label="anchor" href="#creating-applications"></a>
</h2>
<p>Developers can also create applications that customize the machinery
of the <em>alabaster</em> framework for specific needs. In most cases,
this involves storing more metadata to describe the object in more
detail. For example, we might want to remember the identity of the
author for each object. This is achieved by creating an
application-specific saving generic with the same signature as
<code><a href="../reference/saveObject.html">saveObject()</a></code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setGeneric.html" class="external-link">setGeneric</a></span><span class="op">(</span><span class="st">"appSaveObject"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">path</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/standardGeneric.html" class="external-link">standardGeneric</a></span><span class="op">(</span><span class="st">"appSaveObject"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># File names with leading underscores are reserved for application-specific</span></span>
<span>    <span class="co"># use, so they won't clash with anything produced by saveObject.</span></span>
<span>    <span class="va">metapath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"_metadata.json"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">ans</span>, auto_unbox<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, file<span class="op">=</span><span class="va">metapath</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "appSaveObject"</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"appSaveObject"</span>, <span class="st">"ANY"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">path</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/saveObject.html">saveObject</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">path</span>, <span class="va">...</span><span class="op">)</span> <span class="co"># does the real work</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>authors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.info.html" class="external-link">Sys.info</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="st">"user"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co"># adds the desired metadata</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We can specialize the behavior for specific classes like DataFrames.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"appSaveObject"</span>, <span class="st">"DFrame"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">path</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/NextMethod.html" class="external-link">callNextMethod</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">ans</span><span class="op">$</span><span class="va">columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">ans</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Applications should call <code><a href="../reference/altSaveObject.html">altSaveObjectFunction()</a></code> to
instruct <code><a href="../reference/altSaveObject.html">altSaveObject()</a></code> to use this new generic. This
ensures that the customizations are applied to all child objects, such
as the nested <code>DataFrame</code> below.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a friendly user-visible function to handle the generic override; this</span></span>
<span><span class="co"># is reversed on function exit to avoid interfering with other applications. </span></span>
<span><span class="va">saveForApplication</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">path</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span> </span>
<span>    <span class="va">old</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/altSaveObject.html">altSaveObjectFunction</a></span><span class="op">(</span><span class="va">appSaveObject</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="fu"><a href="../reference/altSaveObject.html">altSaveObjectFunction</a></span><span class="op">(</span><span class="va">old</span><span class="op">)</span><span class="op">)</span> </span>
<span>    <span class="fu"><a href="../reference/altSaveObject.html">altSaveObject</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">path</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Saving our mocked up DataFrame with our overrides active.</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html" class="external-link">DataFrame</a></span><span class="op">(</span>Z<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, AA<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html" class="external-link">DataFrame</a></span><span class="op">(</span>B<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, C<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">saveForApplication</span><span class="op">(</span><span class="va">df2</span>, <span class="va">tmp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Both the parent and child DataFrames have new metadata.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="st">"_metadata.json"</span><span class="op">)</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## {"authors":["root"],"columns":["Z","AA"]}</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="st">"other_columns/1/_metadata.json"</span><span class="op">)</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## {"authors":["root"],"columns":["B","C"]}</span></span></code></pre>
<p>The reading function can be similarly overridden by setting
<code><a href="../reference/altReadObject.html">altReadObjectFunction()</a></code> to instruct all
<code><a href="../reference/altReadObject.html">altReadObject()</a></code> calls to use the override. This allows
applications to, e.g., do something with the metadata that we just
added.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Defining the override for altReadObject().</span></span>
<span><span class="va">appReadObject</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span>, <span class="va">metadata</span><span class="op">=</span><span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readObjectFile.html">readObjectFile</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Print custom message based on the type and application-specific metadata.</span></span>
<span>    <span class="va">appmeta</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"_metadata.json"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"I am a "</span>, <span class="va">metadata</span><span class="op">$</span><span class="va">type</span>, <span class="st">" created by "</span>, <span class="va">appmeta</span><span class="op">$</span><span class="va">authors</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">".\n"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"data_frame"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">all.cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">appmeta</span><span class="op">$</span><span class="va">columns</span>, collapse<span class="op">=</span><span class="st">", "</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"I have the following columns: "</span>, <span class="va">all.cols</span>, <span class="st">".\n"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="fu"><a href="../reference/readObject.html">readObject</a></span><span class="op">(</span><span class="va">path</span>, metadata<span class="op">=</span><span class="va">metadata</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Creating a user-friendly function to set the override before the read.</span></span>
<span><span class="va">readForApplication</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span>, <span class="va">metadata</span><span class="op">=</span><span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">old</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/altReadObject.html">altReadObjectFunction</a></span><span class="op">(</span><span class="va">appReadObject</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="fu"><a href="../reference/altReadObject.html">altReadObjectFunction</a></span><span class="op">(</span><span class="va">old</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/altReadObject.html">altReadObject</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">metadata</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># This diverts to the override with printing of custom messages.</span></span>
<span><span class="fu">readForApplication</span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## I am a data_frame created by root.</span></span>
<span><span class="co">## I have the following columns: Z, AA.</span></span>
<span><span class="co">## I am a data_frame created by root.</span></span>
<span><span class="co">## I have the following columns: B, C.</span></span></code></pre>
<pre><code><span><span class="co">## DataFrame with 5 rows and 2 columns</span></span>
<span><span class="co">##          Z                 AA</span></span>
<span><span class="co">##   &lt;factor&gt;        &lt;DataFrame&gt;</span></span>
<span><span class="co">## 1        1 0.289892: 0.648043</span></span>
<span><span class="co">## 2        2 0.678380: 0.075804</span></span>
<span><span class="co">## 3        3 0.735320: 0.491761</span></span>
<span><span class="co">## 4        4 0.195957:-0.753541</span></span>
<span><span class="co">## 5        5 0.980540: 0.349027</span></span></code></pre>
<p>By overriding the saving and reading process for one or more classes,
each application can customize the behavior of <em>alabaster</em> to
their own needs.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.4.0 Patched (2024-04-24 r86483)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: Etc/UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] Matrix_1.7-0         alabaster.base_1.5.1 S4Vectors_0.42.0    </span></span>
<span><span class="co">## [4] BiocGenerics_0.50.0  BiocStyle_2.32.0    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] jsonlite_1.8.8          compiler_4.4.0          BiocManager_1.30.22    </span></span>
<span><span class="co">##  [4] Rcpp_1.0.12             rhdf5filters_1.16.0     jquerylib_0.1.4        </span></span>
<span><span class="co">##  [7] systemfonts_1.0.6       textshaping_0.3.7       yaml_2.3.8             </span></span>
<span><span class="co">## [10] fastmap_1.1.1           lattice_0.22-6          R6_2.5.1               </span></span>
<span><span class="co">## [13] knitr_1.46              htmlwidgets_1.6.4       bookdown_0.39          </span></span>
<span><span class="co">## [16] desc_1.4.3              bslib_0.7.0             rlang_1.1.3            </span></span>
<span><span class="co">## [19] cachem_1.0.8            xfun_0.43               fs_1.6.4               </span></span>
<span><span class="co">## [22] sass_0.4.9              memoise_2.0.1           cli_3.6.2              </span></span>
<span><span class="co">## [25] pkgdown_2.0.9           magrittr_2.0.3          Rhdf5lib_1.26.0        </span></span>
<span><span class="co">## [28] grid_4.4.0              digest_0.6.35           alabaster.schemas_1.4.0</span></span>
<span><span class="co">## [31] rhdf5_2.48.0            lifecycle_1.0.4         vctrs_0.6.5            </span></span>
<span><span class="co">## [34] evaluate_0.23           ragg_1.3.0              rmarkdown_2.26         </span></span>
<span><span class="co">## [37] purrr_1.0.2             tools_4.4.0             htmltools_0.5.8.1</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Aaron Lun.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
